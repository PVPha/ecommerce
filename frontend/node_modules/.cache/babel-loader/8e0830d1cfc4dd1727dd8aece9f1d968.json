{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Desktop\\\\freelancerCoder\\\\Ecommerce\\\\frontend\\\\src\\\\components\\\\OpenChatBtn.js\";\nimport React, { useContext, useEffect, useRef, useState } from \"react\";\nimport \"../Styles/Chat.css\";\nimport \"../App.css\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faComment, faPaperPlane } from \"@fortawesome/free-solid-svg-icons\";\nimport socketIOClient from \"socket.io-client\";\nimport { withRouter } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { UserContext } from \"../contexts/User\";\nconst ENDPOINT = \"http://localhost:4000\";\n\nfunction OpenChatBtn(props) {\n  const messageRef = useRef();\n  const inputRef = useRef();\n  const [openChat, setOpenChat] = useState(false);\n  const [onHover, setOnHover] = useState(false);\n  const [inputValue, setInputValue] = useState(\"\");\n  const socket = socketIOClient(ENDPOINT);\n  const [chatList, setChatList] = useState([]);\n  const [userName, setUserName] = useState(\"\");\n  const [userEmail, setUserEmail] = useState(\"\");\n  const [userInfoExist, setUserInfoExist] = useState(false);\n  const {\n    userInfo\n  } = useContext(UserContext);\n  useEffect(() => {\n    if (userInfo) {\n      setUserName(userInfo.userName);\n      setUserEmail(userInfo.userEmail);\n      setUserInfoExist(true);\n      sessionStorage.removeItem(\"chat-id\");\n      sessionStorage.setItem(\"chat-id\", userInfo._id);\n    }\n\n    if (!sessionStorage.getItem(\"chat-id\")) {\n      sessionStorage.setItem(\"chat-id\", Math.floor(Math.random() * 190000000) + 100000000);\n    }\n\n    axios.get(`http://localhost:4000/chat/${sessionStorage.getItem(\"chat-id\")}`).then(res => {\n      if (res.data.length > 0) setChatList(res.data[0].chatContent);\n    });\n  }, [userInfo]);\n  useEffect(() => {\n    socket.emit(\"join\", {\n      sessionId: sessionStorage.getItem(\"chat-id\"),\n      isAdmin: false\n    });\n    socket.on(\"sendFirstInfo\", data => {\n      if (data.length > 0) setChatList(data[0].chatContent);\n    });\n    socket.on(\"thread\", data => {\n      setChatList(data.chatContent);\n    });\n    socket.on(\"admin-msg\", function (data) {\n      setChatList(chatList => [...chatList, data]);\n      console.log(data);\n      setTimeout(() => {\n        messageRef.current.scrollIntoView({\n          behavior: \"smooth\"\n        });\n      }, 100);\n    });\n  }, []);\n\n  const handleChange = event => {\n    setInputValue({ ...inputValue,\n      [event.target.name]: event.target.value\n    });\n  };\n\n  const location = props.history.location.pathname;\n\n  const sendFirstChatOnSubmit = event => {\n    event.preventDefault();\n    socket.emit(\"firstMessage\", {\n      userInfo: userInfo || null,\n      sessionId: sessionStorage.getItem(\"chat-id\"),\n      chatName: userName,\n      chatEmail: userEmail,\n      chatContent: [{\n        text: inputValue.chatContent,\n        time: new Date()\n      }]\n    });\n    setChatList(chatList => [...chatList, {\n      text: inputValue.chatContent,\n      time: new Date()\n    }]);\n  };\n\n  const sendChatOnSubmit = event => {\n    event.preventDefault();\n    socket.emit(\"messageSend\", {\n      sessionId: sessionStorage.getItem(\"chat-id\"),\n      text: inputValue.messageSend,\n      time: new Date()\n    });\n    setChatList(chatList => [...chatList, {\n      text: inputValue.messageSend,\n      time: new Date()\n    }]);\n    setTimeout(() => {\n      messageRef.current.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    }, 100);\n    inputRef.current.value = \"\";\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: location === \"/admin\" || location === \"/admin/dashboard\" ? \"chat-btn displayNone\" : \"chat-btn\",\n    onMouseEnter: () => {\n      setOnHover(true);\n    },\n    onMouseLeave: () => {\n      if (openChat) {\n        setOnHover(true);\n      } else setOnHover(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: onHover ? \"chat-btn-container chat-btn-hover\" : \"chat-btn-container\",\n    onClick: () => {\n      if (messageRef.current) messageRef.current.scrollIntoView({\n        behavior: \"smooth\"\n      });\n\n      if (openChat) {\n        setOpenChat(false);\n        setOnHover(false);\n      } else {\n        setOpenChat(true);\n        setOnHover(true);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faComment,\n    className: \"icon\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }\n  }, \"Live Chat\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: openChat ? \"chat-box hide_chat_box\" : \"chat-box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-box-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, \"Live Chat\"), chatList.length === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-box-body\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }, userInfoExist === true && /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: sendFirstChatOnSubmit,\n    className: openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 17\n    }\n  }, \"Introduce yourself *\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    onChange: event => {\n      setUserName(event.target.value);\n    },\n    value: userName,\n    placeholder: \"Name\",\n    className: \"intro\",\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    onChange: event => {\n      setUserEmail(event.target.value);\n    },\n    value: userEmail,\n    placeholder: \"Email\",\n    className: \"intro\",\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 17\n    }\n  }, \"Message *\"), /*#__PURE__*/React.createElement(\"textarea\", {\n    name: \"chatContent\",\n    type: \"textarea\",\n    onChange: handleChange,\n    className: \"message\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn chat-box-body-btn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, \"Chat\")), userInfoExist === false && /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: sendFirstChatOnSubmit,\n    className: openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 17\n    }\n  }, \"Introduce yourself *\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    onChange: event => {\n      setUserName(event.target.value);\n    },\n    value: userName,\n    placeholder: \"Name\",\n    className: \"intro\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    onChange: event => {\n      setUserEmail(event.target.value);\n    },\n    value: userEmail,\n    placeholder: \"Email\",\n    className: \"intro\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }, \"Message *\"), /*#__PURE__*/React.createElement(\"textarea\", {\n    name: \"chatContent\",\n    type: \"textarea\",\n    onChange: handleChange,\n    className: \"message\",\n    required: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"btn chat-box-body-btn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  }, \"Chat\"))), chatList.length > 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat-box-body no-p\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: sendChatOnSubmit,\n    className: openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex-col chat-box-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 15\n    }\n  }, chatList.map((item, index) => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      key: index,\n      ref: messageRef,\n      className: \"chat-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 21\n      }\n    }, item.fromAdmin !== true && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"clienttext\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 27\n      }\n    }, item.text)), item.fromAdmin === true && /*#__PURE__*/React.createElement(\"div\", {\n      className: \"admintext\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 27\n      }\n    }, item.text)));\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex chat-box-send\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    name: \"messageSend\",\n    type: \"text\",\n    onChange: handleChange,\n    placeholder: \"Make a message\",\n    ref: inputRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"flex-center sendchat\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(FontAwesomeIcon, {\n    icon: faPaperPlane,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 19\n    }\n  })))))));\n}\n\nexport default withRouter(OpenChatBtn);","map":{"version":3,"sources":["C:/Users/Admin/Desktop/freelancerCoder/Ecommerce/frontend/src/components/OpenChatBtn.js"],"names":["React","useContext","useEffect","useRef","useState","FontAwesomeIcon","faComment","faPaperPlane","socketIOClient","withRouter","axios","UserContext","ENDPOINT","OpenChatBtn","props","messageRef","inputRef","openChat","setOpenChat","onHover","setOnHover","inputValue","setInputValue","socket","chatList","setChatList","userName","setUserName","userEmail","setUserEmail","userInfoExist","setUserInfoExist","userInfo","sessionStorage","removeItem","setItem","_id","getItem","Math","floor","random","get","then","res","data","length","chatContent","emit","sessionId","isAdmin","on","console","log","setTimeout","current","scrollIntoView","behavior","handleChange","event","target","name","value","location","history","pathname","sendFirstChatOnSubmit","preventDefault","chatName","chatEmail","text","time","Date","sendChatOnSubmit","messageSend","map","item","index","fromAdmin"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport \"../Styles/Chat.css\";\r\nimport \"../App.css\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faComment, faPaperPlane } from \"@fortawesome/free-solid-svg-icons\";\r\nimport socketIOClient from \"socket.io-client\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { UserContext } from \"../contexts/User\";\r\n\r\nconst ENDPOINT = \"http://localhost:4000\";\r\n\r\nfunction OpenChatBtn(props) {\r\n  const messageRef = useRef();\r\n  const inputRef = useRef();\r\n  const [openChat, setOpenChat] = useState(false);\r\n  const [onHover, setOnHover] = useState(false);\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n\r\n  const socket = socketIOClient(ENDPOINT);\r\n  const [chatList, setChatList] = useState([]);\r\n\r\n  const [userName, setUserName] = useState(\"\");\r\n  const [userEmail, setUserEmail] = useState(\"\");\r\n  const [userInfoExist, setUserInfoExist] = useState(false);\r\n\r\n  const { userInfo } = useContext(UserContext);\r\n\r\n  useEffect(() => {\r\n    if (userInfo) {\r\n      setUserName(userInfo.userName);\r\n      setUserEmail(userInfo.userEmail);\r\n      setUserInfoExist(true);\r\n      sessionStorage.removeItem(\"chat-id\");\r\n      sessionStorage.setItem(\"chat-id\", userInfo._id);\r\n    }\r\n    if (!sessionStorage.getItem(\"chat-id\")) {\r\n      sessionStorage.setItem(\r\n        \"chat-id\",\r\n        Math.floor(Math.random() * 190000000) + 100000000\r\n      );\r\n    }\r\n    axios\r\n      .get(`http://localhost:4000/chat/${sessionStorage.getItem(\"chat-id\")}`)\r\n      .then((res) => {\r\n        if (res.data.length > 0) setChatList(res.data[0].chatContent);\r\n      });\r\n  }, [userInfo]);\r\n\r\n  useEffect(() => {\r\n    socket.emit(\"join\", {\r\n      sessionId: sessionStorage.getItem(\"chat-id\"),\r\n      isAdmin: false,\r\n    });\r\n    socket.on(\"sendFirstInfo\", (data) => {\r\n      if (data.length > 0) setChatList(data[0].chatContent);\r\n    });\r\n    socket.on(\"thread\", (data) => {\r\n      setChatList(data.chatContent);\r\n    });\r\n    socket.on(\"admin-msg\", function (data) {\r\n      setChatList((chatList) => [...chatList, data]);\r\n      console.log(data);\r\n      setTimeout(() => {\r\n        messageRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n      }, 100);\r\n    });\r\n  }, []);\r\n\r\n  const handleChange = (event) => {\r\n    setInputValue({ ...inputValue, [event.target.name]: event.target.value });\r\n  };\r\n  const location = props.history.location.pathname;\r\n\r\n  const sendFirstChatOnSubmit = (event) => {\r\n    event.preventDefault();\r\n    socket.emit(\"firstMessage\", {\r\n      userInfo: userInfo || null,\r\n      sessionId: sessionStorage.getItem(\"chat-id\"),\r\n      chatName: userName,\r\n      chatEmail: userEmail,\r\n      chatContent: [\r\n        {\r\n          text: inputValue.chatContent,\r\n          time: new Date(),\r\n        },\r\n      ],\r\n    });\r\n    setChatList((chatList) => [\r\n      ...chatList,\r\n      {\r\n        text: inputValue.chatContent,\r\n        time: new Date(),\r\n      },\r\n    ]);\r\n  };\r\n\r\n  const sendChatOnSubmit = (event) => {\r\n    event.preventDefault();\r\n    socket.emit(\"messageSend\", {\r\n      sessionId: sessionStorage.getItem(\"chat-id\"),\r\n      text: inputValue.messageSend,\r\n      time: new Date(),\r\n    });\r\n    setChatList((chatList) => [\r\n      ...chatList,\r\n      { text: inputValue.messageSend, time: new Date() },\r\n    ]);\r\n    setTimeout(() => {\r\n      messageRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n    }, 100);\r\n    inputRef.current.value = \"\";\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={\r\n        location === \"/admin\" || location === \"/admin/dashboard\"\r\n          ? \"chat-btn displayNone\"\r\n          : \"chat-btn\"\r\n      }\r\n      onMouseEnter={() => {\r\n        setOnHover(true);\r\n      }}\r\n      onMouseLeave={() => {\r\n        if (openChat) {\r\n          setOnHover(true);\r\n        } else setOnHover(false);\r\n      }}\r\n    >\r\n      <div\r\n        className={\r\n          onHover ? \"chat-btn-container chat-btn-hover\" : \"chat-btn-container\"\r\n        }\r\n        onClick={() => {\r\n          if (messageRef.current)\r\n            messageRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n          if (openChat) {\r\n            setOpenChat(false);\r\n            setOnHover(false);\r\n          } else {\r\n            setOpenChat(true);\r\n            setOnHover(true);\r\n          }\r\n        }}\r\n      >\r\n        <FontAwesomeIcon icon={faComment} className=\"icon\" />\r\n        <p>Live Chat</p>\r\n      </div>\r\n      <div className={openChat ? \"chat-box hide_chat_box\" : \"chat-box\"}>\r\n        <div className=\"chat-box-header\">Live Chat</div>\r\n        {chatList.length === 0 && (\r\n          <div className=\"chat-box-body\">\r\n            {userInfoExist === true && (\r\n              <form\r\n                onSubmit={sendFirstChatOnSubmit}\r\n                className={\r\n                  openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\"\r\n                }\r\n              >\r\n                <label>Introduce yourself *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  onChange={(event) => {\r\n                    setUserName(event.target.value);\r\n                  }}\r\n                  value={userName}\r\n                  placeholder=\"Name\"\r\n                  className=\"intro\"\r\n                  disabled\r\n                ></input>\r\n                <input\r\n                  type=\"email\"\r\n                  onChange={(event) => {\r\n                    setUserEmail(event.target.value);\r\n                  }}\r\n                  value={userEmail}\r\n                  placeholder=\"Email\"\r\n                  className=\"intro\"\r\n                  disabled\r\n                ></input>\r\n                <label>Message *</label>\r\n                <textarea\r\n                  name=\"chatContent\"\r\n                  type=\"textarea\"\r\n                  onChange={handleChange}\r\n                  className=\"message\"\r\n                  required\r\n                ></textarea>\r\n                <button className=\"btn chat-box-body-btn\">Chat</button>\r\n              </form>\r\n            )}\r\n            {userInfoExist === false && (\r\n              <form\r\n                onSubmit={sendFirstChatOnSubmit}\r\n                className={\r\n                  openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\"\r\n                }\r\n              >\r\n                <label>Introduce yourself *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  onChange={(event) => {\r\n                    setUserName(event.target.value);\r\n                  }}\r\n                  value={userName}\r\n                  placeholder=\"Name\"\r\n                  className=\"intro\"\r\n                  required\r\n                ></input>\r\n                <input\r\n                  type=\"email\"\r\n                  onChange={(event) => {\r\n                    setUserEmail(event.target.value);\r\n                  }}\r\n                  value={userEmail}\r\n                  placeholder=\"Email\"\r\n                  className=\"intro\"\r\n                  required\r\n                ></input>\r\n                <label>Message *</label>\r\n                <textarea\r\n                  name=\"chatContent\"\r\n                  type=\"textarea\"\r\n                  onChange={handleChange}\r\n                  className=\"message\"\r\n                  required\r\n                ></textarea>\r\n                <button className=\"btn chat-box-body-btn\">Chat</button>\r\n              </form>\r\n            )}\r\n          </div>\r\n        )}\r\n        {chatList.length > 0 && (\r\n          <div className=\"chat-box-body no-p\">\r\n            <form\r\n              onSubmit={sendChatOnSubmit}\r\n              className={\r\n                openChat ? \"form-chat hide_chat_box_item\" : \"form-chat\"\r\n              }\r\n            >\r\n              <div className=\"flex-col chat-box-list\">\r\n                {chatList.map((item, index) => {\r\n                  return (\r\n                    <div key={index} ref={messageRef} className=\"chat-list\">\r\n                      {item.fromAdmin !== true && (\r\n                        <div className=\"clienttext\">\r\n                          <p>{item.text}</p>\r\n                        </div>\r\n                      )}\r\n                      {item.fromAdmin === true && (\r\n                        <div className=\"admintext\">\r\n                          <p>{item.text}</p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n              <div className=\"flex chat-box-send\">\r\n                <input\r\n                  name=\"messageSend\"\r\n                  type=\"text\"\r\n                  onChange={handleChange}\r\n                  placeholder=\"Make a message\"\r\n                  ref={inputRef}\r\n                ></input>\r\n                <button className=\"flex-center sendchat\">\r\n                  <FontAwesomeIcon icon={faPaperPlane} />\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withRouter(OpenChatBtn);\r\n"]},"metadata":{},"sourceType":"module"}